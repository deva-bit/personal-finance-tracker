<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>üí∞ My Expenses</title>    <link rel="preconnect" href="https://fonts.googleapis.com">    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }        body {            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            min-height: 100vh;            padding: 20px;        }        .container {            max-width: 1000px;            margin: 0 auto;        }        .header {            display: flex;            justify-content: space-between;            align-items: center;            margin-bottom: 25px;            flex-wrap: wrap;            gap: 15px;        }        h1 {            color: white;            font-size: 1.8em;            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);        }        .header-buttons {            display: flex;            gap: 10px;        }        .header-btn {            background: rgba(255,255,255,0.2);            color: white;            border: none;            padding: 10px 20px;            border-radius: 8px;            cursor: pointer;            font-size: 14px;            font-weight: 500;            transition: all 0.3s;            text-decoration: none;            display: flex;            align-items: center;            gap: 6px;        }        .header-btn:hover {            background: rgba(255,255,255,0.3);        }        .month-selector {            background: white;            border-radius: 12px;            padding: 15px 20px;            margin-bottom: 20px;            display: flex;            align-items: center;            justify-content: center;            gap: 15px;            box-shadow: 0 5px 15px rgba(0,0,0,0.1);            flex-wrap: wrap;        }        .month-selector button {            background: #667eea;            color: white;            border: none;            width: 40px;            height: 40px;            border-radius: 8px;            cursor: pointer;            font-size: 16px;            transition: background 0.3s;        }        .month-selector button:hover {            background: #5568d3;        }        .month-display {            display: flex;            gap: 10px;        }        .month-selector select {            padding: 10px 15px;            border: 2px solid #e2e8f0;            border-radius: 8px;            font-size: 15px;            cursor: pointer;            background: white;            font-family: inherit;        }        .month-selector select:focus {            outline: none;            border-color: #667eea;        }        .cards {            display: grid;            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));            gap: 15px;            margin-bottom: 20px;        }        .card {            background: white;            border-radius: 16px;            padding: 25px;            box-shadow: 0 10px 30px rgba(0,0,0,0.15);            transition: transform 0.3s;        }        .card:hover {            transform: translateY(-3px);        }        .card h2 {            color: #667eea;            font-size: 0.85em;            margin-bottom: 12px;            text-transform: uppercase;            letter-spacing: 0.5px;            font-weight: 600;        }        .card .amount {            font-size: 2em;            font-weight: 700;            color: #1a1a2e;            margin-bottom: 5px;        }        .card .subtitle {            color: #718096;            font-size: 0.85em;        }        .table-card {            background: white;            border-radius: 16px;            padding: 25px;            box-shadow: 0 10px 30px rgba(0,0,0,0.15);            margin-bottom: 20px;            overflow-x: auto;        }        .table-card h2 {            color: #1a1a2e;            margin-bottom: 20px;            font-size: 1.2em;            font-weight: 600;        }        table {            width: 100%;            border-collapse: collapse;            font-size: 14px;        }        th {            background: #f7fafc;            padding: 12px 15px;            text-align: left;            font-weight: 600;            color: #4a5568;            border-bottom: 2px solid #e2e8f0;        }        td {            padding: 12px 15px;            border-bottom: 1px solid #e2e8f0;            color: #2d3748;        }        tr:hover {            background: #f7fafc;        }        .amount-cell {            color: #667eea;            font-weight: 600;        }        .category-badge {            display: inline-block;            padding: 4px 12px;            border-radius: 20px;            font-size: 0.8em;            font-weight: 600;        }        .cat-food { background: #fef3c7; color: #92400e; }        .cat-transport { background: #dbeafe; color: #1e40af; }        .cat-entertainment { background: #fce7f3; color: #9f1239; }        .cat-shopping { background: #e0e7ff; color: #3730a3; }        .cat-bills { background: #fecaca; color: #991b1b; }        .cat-health { background: #d1fae5; color: #065f46; }        .cat-other { background: #e5e7eb; color: #1f2937; }        .cat-subscription { background: #fef08a; color: #854d0e; }        .delete-btn {            background: #fee2e2;            color: #dc2626;            border: none;            padding: 6px 12px;            border-radius: 6px;            cursor: pointer;            font-size: 12px;            font-weight: 500;            transition: all 0.2s;        }        .delete-btn:hover {            background: #dc2626;            color: white;        }        .loading {            text-align: center;            padding: 80px;            color: white;            font-size: 1.2em;        }        .refresh-info {            text-align: center;            color: rgba(255,255,255,0.8);            margin-top: 20px;            font-size: 0.85em;        }        .quick-tip {            background: rgba(255,255,255,0.15);            color: white;            padding: 15px 20px;            border-radius: 12px;            margin-bottom: 20px;            font-size: 14px;            display: flex;            align-items: center;            gap: 10px;        }        .quick-tip code {            background: rgba(255,255,255,0.2);            padding: 3px 8px;            border-radius: 4px;            font-family: monospace;        }        @media (max-width: 600px) {            .header { flex-direction: column; align-items: flex-start; }            h1 { font-size: 1.5em; }            .card .amount { font-size: 1.6em; }            .table-card { padding: 15px; }            td, th { padding: 10px 8px; font-size: 13px; }        }    </style></head><body>    <div class="container">        <div class="header">            <h1>üí∞ My Expenses</h1>            <div class="header-buttons">                <a href="/" class="header-btn">üë§ Switch User</a>                <button class="header-btn" onclick="loadData()">üîÑ Refresh</button>            </div>        </div>                <div class="quick-tip">            üí° <strong>Tip:</strong> Send <code>add lunch 15 food</code> on WhatsApp to add expenses!        </div>        <div class="month-selector">            <button onclick="changeMonth(-1)">‚óÄ</button>            <div class="month-display">                <select id="monthSelect" onchange="loadData()">                    <option value="1">January</option>                    <option value="2">February</option>                    <option value="3">March</option>                    <option value="4">April</option>                    <option value="5">May</option>                    <option value="6">June</option>                    <option value="7">July</option>                    <option value="8">August</option>                    <option value="9">September</option>                    <option value="10">October</option>                    <option value="11">November</option>                    <option value="12">December</option>                </select>                <select id="yearSelect" onchange="loadData()"></select>            </div>            <button onclick="changeMonth(1)">‚ñ∂</button>        </div>                <div id="loading" class="loading">‚è≥ Loading your expenses...</div>                <div id="content" style="display: none;">            <div class="cards">                <div class="card">                    <h2>üìÖ This Month</h2>                    <div class="amount" id="monthlyTotal">$0.00</div>                    <div class="subtitle" id="monthlyCount">0 expenses</div>                </div>                <div class="card">                    <h2>üìÜ This Week</h2>                    <div class="amount" id="weeklyTotal">$0.00</div>                    <div class="subtitle" id="weeklyCount">0 expenses</div>                </div>            </div>                        <div class="table-card">                <h2>üìä Spending by Category</h2>                <table>                    <thead>                        <tr><th>Category</th><th>Count</th><th>Total</th><th>%</th></tr>                    </thead>                    <tbody id="categoryTable">                        <tr><td colspan="4" style="text-align:center;padding:30px;color:#999;">No expenses yet</td></tr>                    </tbody>                </table>            </div>            <div class="table-card">                <h2>üìù Recent Expenses</h2>                <table>                    <thead>                        <tr><th>Date</th><th>Description</th><th>Category</th><th>Amount</th><th>Action</th></tr>                    </thead>                    <tbody id="recentTable">                        <tr><td colspan="5" style="text-align:center;padding:30px;color:#999;">No expenses yet</td></tr>                    </tbody>                </table>            </div>            <div class="refresh-info">                üîÑ Auto-refreshes every 30 seconds | Last updated: <span id="lastUpdate">-</span>            </div>        </div>    </div>    <script>        const urlParams = new URLSearchParams(window.location.search);        const phoneNumber = urlParams.get('phone');                let selectedMonth = new Date().getMonth() + 1;        let selectedYear = new Date().getFullYear();        function initializeDateSelectors() {            document.getElementById('monthSelect').value = selectedMonth;            const yearSelect = document.getElementById('yearSelect');            const currentYear = new Date().getFullYear();            for (let year = 2024; year <= currentYear + 1; year++) {                const option = document.createElement('option');                option.value = year;                option.textContent = year;                if (year === selectedYear) option.selected = true;                yearSelect.appendChild(option);            }        }        function changeMonth(direction) {            selectedMonth += direction;            if (selectedMonth > 12) { selectedMonth = 1; selectedYear++; }            else if (selectedMonth < 1) { selectedMonth = 12; selectedYear--; }            document.getElementById('monthSelect').value = selectedMonth;            document.getElementById('yearSelect').value = selectedYear;            loadData();        }                if (!phoneNumber) {            document.getElementById('loading').innerHTML = '<div style="color:#ff6b6b;">‚ùå No phone number provided.<br><br><a href="/" style="color:white;">‚Üê Go to login page</a></div>';        } else {            initializeDateSelectors();            loadData();            setInterval(loadData, 30000);        }        async function loadData() {            try {                selectedMonth = parseInt(document.getElementById('monthSelect').value);                selectedYear = parseInt(document.getElementById('yearSelect').value);                                const API = window.location.origin + '/api';                const [monthly, weekly, categories, recent] = await Promise.all([                    fetch(`${API}/expenses/monthly?phone=${phoneNumber}&month=${selectedMonth}&year=${selectedYear}`).then(r => r.json()),                    fetch(`${API}/expenses/weekly?phone=${phoneNumber}`).then(r => r.json()),                    fetch(`${API}/expenses/by-category?phone=${phoneNumber}&month=${selectedMonth}&year=${selectedYear}`).then(r => r.json()),                    fetch(`${API}/expenses/recent?phone=${phoneNumber}&month=${selectedMonth}&year=${selectedYear}`).then(r => r.json())                ]);                displayData({ monthly, weekly, categories, recent });                document.getElementById('loading').style.display = 'none';                document.getElementById('content').style.display = 'block';                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();            } catch (error) {                console.error('Error:', error);                document.getElementById('loading').innerHTML = '<div style="color:#ff6b6b;">‚ùå Error loading data</div>';            }        }        function displayData(data) {            const monthlyTotal = parseFloat(data.monthly.total || 0);            document.getElementById('monthlyTotal').textContent = `$${monthlyTotal.toFixed(2)}`;            document.getElementById('monthlyCount').textContent = `${data.monthly.count || 0} expenses`;                        const weeklyTotal = parseFloat(data.weekly.total || 0);            document.getElementById('weeklyTotal').textContent = `$${weeklyTotal.toFixed(2)}`;            document.getElementById('weeklyCount').textContent = `${data.weekly.count || 0} expenses`;                        const catTable = document.getElementById('categoryTable');            if (data.categories.length === 0) {                catTable.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:30px;color:#999;">No expenses yet</td></tr>';            } else {                catTable.innerHTML = data.categories.map(cat => {                    const total = parseFloat(cat.total);                    const pct = monthlyTotal > 0 ? ((total / monthlyTotal) * 100).toFixed(0) : 0;                    return `<tr>                        <td><span class="category-badge cat-${cat.category}">${cat.category}</span></td>                        <td>${cat.count}</td>                        <td class="amount-cell">$${total.toFixed(2)}</td>                        <td>${pct}%</td>                    </tr>`;                }).join('');            }            const recTable = document.getElementById('recentTable');            if (data.recent.length === 0) {                recTable.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:#999;">No expenses yet</td></tr>';            } else {                recTable.innerHTML = data.recent.map(exp => `                    <tr>                        <td>${exp.date}</td>                        <td><strong>${exp.description}</strong><br><small style="color:#999;">${exp.added_on}</small></td>                        <td><span class="category-badge cat-${exp.category}">${exp.category}</span></td>                        <td class="amount-cell">$${parseFloat(exp.amount).toFixed(2)}</td>                        <td><button class="delete-btn" onclick="deleteExpense(${exp.id})">Delete</button></td>                    </tr>                `).join('');            }        }        async function deleteExpense(id) {            if (!confirm('Delete this expense?')) return;            try {                const response = await fetch(`${window.location.origin}/api/expenses/${id}?phone=${phoneNumber}`, { method: 'DELETE' });                if (response.ok) { loadData(); }                else { alert('Failed to delete'); }            } catch (error) { alert('Error deleting'); }        }    </script></body></html>